name: Update USD/RUB Rate
on:
  schedule:
    - cron: '0 * * * *'  # –ö–∞–∂–¥—ã–π —á–∞—Å
  workflow_dispatch:     # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  update-rate:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
    
    steps:
      # 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      # 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      # 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      - name: Install dependencies
        run: pip install requests
      
      # 4. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
      - name: Fetch currency rate
        run: python fetch_currency.py
      
      # 5. –ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π
      - name: Commit & Push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add usd_rub_rate.json
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if [ -z "$(git status --porcelain)" ]; then
            echo "üü¢ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          else
            git commit -m "Auto: Update USD/RUB rate"
            git pull --rebase
            git push
            echo "üöÄ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"
          fi
